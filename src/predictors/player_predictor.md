# PlayerPredictor - プレイヤー検出予測器

## 概要
`PlayerPredictor` は、テニス試合の動画からプレイヤーを検出・トラッキングする責任を持つ予測器です。物体検出モデル（DETR系）を使用して、フレームごとに選手の位置をバウンディングボックスで特定し、可視化および動画出力機能を提供します。

## 主要な責任

### 1. プレイヤー検出
- **バッチ推論**: 複数フレームを同時に処理し、効率的な検出を実現
- **オブジェクト検出**: 各フレーム内のプレイヤーを検出し、バウンディングボックスで位置を特定
- **信頼度スコア**: 検出結果に信頼度スコアを付与し、閾値による信頼性制御を実現

### 2. 前処理・後処理
- **RGB変換**: BGR→RGB変換によるモデル入力形式への変換
- **プロセッサ連携**: HuggingFace系のprocessorと連携した前処理・後処理
- **座標変換**: モデル出力座標を元の画像解像度に変換

### 3. 可視化・出力
- **オーバーレイ描画**: 検出結果をフレームに描画（バウンディングボックス + ラベル + スコア）
- **動画出力**: 処理結果を動画ファイルとして保存
- **バッチ処理**: 指定されたバッチサイズでの効率的な動画処理

## 主要メソッド

### predict(frames: List[np.ndarray]) -> List[List[dict]]
- フレーム群からプレイヤーを検出
- 戻り値: `[{"bbox": [x0,y0,x1,y1], "score": float, "label": str}]` のリスト

### overlay(frame: np.ndarray, detections: List[dict]) -> np.ndarray
- 検出結果をフレームに描画
- 赤色のバウンディングボックスとラベル・スコアを表示

### run(input_path, output_path, batch_size=8)
- 動画ファイル全体を処理し、検出結果付きの動画を出力
- プログレスバー付きの処理状況表示

## 設定パラメータ

- **threshold**: 検出信頼度の閾値（デフォルト: 0.6）
- **device**: 推論デバイス（CPU/GPU）
- **use_half**: 半精度推論の有効化
- **label_map**: ラベルIDから名前への変換マップ

## 使用場面

- テニス試合動画におけるプレイヤーの位置追跡
- プレイヤーの動き分析の前処理
- 他の予測器（ポーズ推定など）への入力データ生成
- 試合映像の自動アノテーション

## 連携する他の予測器

- **PosePredictor**: プレイヤー検出結果を元にポーズ推定を実行
- **EventPredictor**: プレイヤー位置情報をイベント検知の特徴量として使用 